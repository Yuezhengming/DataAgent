# Spring AI Alibaba DataAgent å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿæ­å»ºå’Œè¿è¡Œ DataAgent é¡¹ç›®ã€‚

---

## ğŸ“‹ å‰ç½®è¦æ±‚

### å¿…éœ€ç¯å¢ƒ

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|-----|---------|------|
| **Java** | 17+ | åç«¯è¿è¡Œç¯å¢ƒ |
| **Maven** | 3.6+ | é¡¹ç›®æ„å»ºå·¥å…· |
| **Node.js** | 18+ | å‰ç«¯è¿è¡Œç¯å¢ƒ |
| **MySQL** | 8.0+ | æ•°æ®åº“ |

### å¯é€‰ç¯å¢ƒ

| è½¯ä»¶ | ç”¨é€” |
|-----|------|
| **Docker** | å®¹å™¨åŒ–éƒ¨ç½²ã€Python ä»£ç éš”ç¦»æ‰§è¡Œ |
| **Milvus** | ç”Ÿäº§ç¯å¢ƒå‘é‡æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰ |

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ5åˆ†é’Ÿï¼‰

### æ­¥éª¤ 1: å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/alibaba/spring-ai-alibaba.git
cd spring-ai-alibaba/community/data-agent/DataAgent
```

### æ­¥éª¤ 2: å‡†å¤‡æ•°æ®åº“

**æ–¹å¼ 1: ä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰**

```bash
docker run -d \
  --name dataagent-mysql \
  -p 3307:3306 \
  -e MYSQL_ROOT_PASSWORD=root \
  -e MYSQL_DATABASE=data_agent \
  mysql:8.0
```

**æ–¹å¼ 2: ä½¿ç”¨æœ¬åœ° MySQL**

```sql
CREATE DATABASE data_agent CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### æ­¥éª¤ 3: é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# é˜¿é‡Œäº‘ DashScope API Keyï¼ˆå¿…éœ€ï¼‰
export AI_DASHSCOPE_API_KEY=your-dashscope-api-key

# æ•°æ®åº“è¿æ¥ï¼ˆå¯é€‰ï¼Œé»˜è®¤å€¼å¦‚ä¸‹ï¼‰
export DATA_AGENT_DATASOURCE_URL=jdbc:mysql://127.0.0.1:3307/data_agent?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
export DATA_AGENT_DATASOURCE_USERNAME=root
export DATA_AGENT_DATASOURCE_PASSWORD=root
```

**è·å– DashScope API Key**:
1. è®¿é—® [é˜¿é‡Œäº‘ DashScope æ§åˆ¶å°](https://dashscope.console.aliyun.com/)
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. åˆ›å»º API Key

### æ­¥éª¤ 4: å¯åŠ¨åç«¯

```bash
cd spring-ai-alibaba-data-agent-management
mvn clean spring-boot:run
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
Started DataAgentApplication in 15.234 seconds
```

åç«¯æœåŠ¡è¿è¡Œåœ¨: `http://localhost:8065`

### æ­¥éª¤ 5: å¯åŠ¨å‰ç«¯

```bash
cd spring-ai-alibaba-data-agent-frontend
npm install
npm run dev
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
VITE v5.x.x  ready in xxx ms

âœ  Local:   http://localhost:3000/
```

å‰ç«¯åº”ç”¨è¿è¡Œåœ¨: `http://localhost:3000`

---

## ğŸ¯ ç¬¬ä¸€æ¬¡ä½¿ç”¨

### 1. åˆ›å»ºæ™ºèƒ½ä½“

è®¿é—® `http://localhost:3000`ï¼Œç‚¹å‡»"åˆ›å»ºæ™ºèƒ½ä½“"ï¼š

**åŸºæœ¬ä¿¡æ¯**:
- åç§°: `é”€å”®æ•°æ®åˆ†æåŠ©æ‰‹`
- æè¿°: `ä¸“æ³¨äºé”€å”®æ•°æ®åˆ†æ`
- åˆ†ç±»: `æ•°æ®åˆ†æ`
- çŠ¶æ€: `å·²å‘å¸ƒ`

### 2. é…ç½®æ•°æ®æº

**åˆ›å»ºæ•°æ®æº**:
1. è¿›å…¥"æ•°æ®æºç®¡ç†"
2. ç‚¹å‡»"æ·»åŠ æ•°æ®æº"
3. å¡«å†™è¿æ¥ä¿¡æ¯ï¼š
   - åç§°: `æµ‹è¯•æ•°æ®åº“`
   - ç±»å‹: `MySQL`
   - ä¸»æœº: `127.0.0.1`
   - ç«¯å£: `3307`
   - æ•°æ®åº“å: `product_db`ï¼ˆç¤ºä¾‹æ•°æ®åº“ï¼‰
   - ç”¨æˆ·å: `root`
   - å¯†ç : `root`
4. ç‚¹å‡»"æµ‹è¯•è¿æ¥"
5. ä¿å­˜

**ç»‘å®šæ•°æ®æºåˆ°æ™ºèƒ½ä½“**:
1. è¿›å…¥æ™ºèƒ½ä½“è¯¦æƒ…é¡µ
2. é€‰æ‹©"æ•°æ®æº"æ ‡ç­¾
3. ç‚¹å‡»"ç»‘å®šæ•°æ®æº"
4. é€‰æ‹©åˆšåˆ›å»ºçš„æ•°æ®æº
5. ç‚¹å‡»"åˆå§‹åŒ– Schema"
6. é€‰æ‹©è¦åˆ†æçš„è¡¨ï¼ˆå¦‚ `users`, `orders`, `products`ï¼‰
7. ç¡®è®¤åˆå§‹åŒ–

### 3. å¼€å§‹å¯¹è¯

1. ç‚¹å‡»æ™ºèƒ½ä½“å¡ç‰‡ä¸Šçš„"è¿è¡Œ"æŒ‰é’®
2. åœ¨è¾“å…¥æ¡†è¾“å…¥è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼š
   ```
   æŸ¥è¯¢æœ€è¿‘ä¸€å‘¨é”€å”®é¢æœ€é«˜çš„å‰10ä¸ªäº§å“
   ```
3. è§‚å¯Ÿ Graph å·¥ä½œæµçš„æ‰§è¡Œè¿‡ç¨‹
4. æŸ¥çœ‹ç”Ÿæˆçš„ SQL å’Œåˆ†æç»“æœ

---

## ğŸ“Š ç¤ºä¾‹æ•°æ®åº“

é¡¹ç›®æä¾›äº†ç¤ºä¾‹æ•°æ®åº“è„šæœ¬ï¼ŒåŒ…å«ç”µå•†åœºæ™¯çš„è¡¨ç»“æ„ï¼š

**ä½ç½®**: `spring-ai-alibaba-data-agent-management/src/main/resources/sql/product_schema.sql`

**è¡¨ç»“æ„**:
- `users` - ç”¨æˆ·è¡¨
- `products` - å•†å“è¡¨
- `orders` - è®¢å•è¡¨
- `order_items` - è®¢å•æ˜ç»†è¡¨

**å¯¼å…¥ç¤ºä¾‹æ•°æ®**:

```bash
# ä½¿ç”¨ Docker MySQL
docker exec -i dataagent-mysql mysql -uroot -proot < spring-ai-alibaba-data-agent-management/src/main/resources/sql/product_schema.sql

# æˆ–ä½¿ç”¨æœ¬åœ° MySQL
mysql -h127.0.0.1 -P3307 -uroot -proot < spring-ai-alibaba-data-agent-management/src/main/resources/sql/product_schema.sql
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### application.yml æ ¸å¿ƒé…ç½®

**ä½ç½®**: `spring-ai-alibaba-data-agent-management/src/main/resources/application.yml`

```yaml
spring:
  # DataAgent ä¸šåŠ¡æ•°æ®åº“ï¼ˆå­˜å‚¨æ™ºèƒ½ä½“ã€ä¼šè¯ç­‰ï¼‰
  datasource:
    url: ${DATA_AGENT_DATASOURCE_URL}
    username: ${DATA_AGENT_DATASOURCE_USERNAME}
    password: ${DATA_AGENT_DATASOURCE_PASSWORD}
  
  ai:
    # å‘é‡æ•°æ®åº“ç±»å‹
    vectorstore:
      type: simple  # å¼€å‘ç¯å¢ƒä½¿ç”¨å†…å­˜å‘é‡åº“
      # type: milvus  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Milvus
    
    # é˜¿é‡Œäº‘ DashScope é…ç½®
    dashscope:
      api-key: ${AI_DASHSCOPE_API_KEY}
      chat:
        options:
          model: qwen-plus  # å¯¹è¯æ¨¡å‹
      embedding:
        options:
          model: text-embedding-v4  # åµŒå…¥æ¨¡å‹
    
    alibaba:
      nl2sql:
        llm-service-type: stream  # æµå¼è¾“å‡º
        code-executor:
          code-pool-executor: local  # Python æ‰§è¡Œç¯å¢ƒ
          # code-pool-executor: docker  # ç”Ÿäº§ç¯å¢ƒæ¨è
        file:
          type: local  # æ–‡ä»¶å­˜å‚¨ç±»å‹
          path: ./uploads  # ä¸Šä¼ æ–‡ä»¶è·¯å¾„
```

### ç¯å¢ƒå˜é‡åˆ—è¡¨

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|-------|------|--------|
| `AI_DASHSCOPE_API_KEY` | DashScope API Key | æ— ï¼ˆå¿…éœ€ï¼‰ |
| `DATA_AGENT_DATASOURCE_URL` | ä¸šåŠ¡æ•°æ®åº“ URL | `jdbc:mysql://127.0.0.1:3307/data_agent...` |
| `DATA_AGENT_DATASOURCE_USERNAME` | æ•°æ®åº“ç”¨æˆ·å | `root` |
| `DATA_AGENT_DATASOURCE_PASSWORD` | æ•°æ®åº“å¯†ç  | `root` |
| `OSS_ACCESS_KEY_ID` | OSS è®¿é—®å¯†é’¥ï¼ˆå¯é€‰ï¼‰ | ç©º |
| `OSS_ACCESS_KEY_SECRET` | OSS å¯†é’¥ï¼ˆå¯é€‰ï¼‰ | ç©º |

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. åç«¯å¯åŠ¨å¤±è´¥ï¼šæ•°æ®åº“è¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**:
```
Communications link failure
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼ˆé»˜è®¤ 3307ï¼‰
- æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é”™è¯¯ä¿¡æ¯**:
```
Network Error
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨ï¼ˆè®¿é—® `http://localhost:8065/echo/ok`ï¼‰
- æ£€æŸ¥å‰ç«¯ä»£ç†é…ç½®ï¼ˆ`vite.config.js`ï¼‰
- æ£€æŸ¥ CORS é…ç½®

### 3. DashScope API è°ƒç”¨å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Invalid API Key
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆï¼ˆæœªè¿‡æœŸï¼‰
- æ£€æŸ¥è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³
- æ£€æŸ¥ç½‘ç»œæ˜¯å¦èƒ½è®¿é—®é˜¿é‡Œäº‘æœåŠ¡

### 4. Schema åˆå§‹åŒ–å¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Failed to initialize schema
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ•°æ®æºè¿æ¥æ˜¯å¦æ­£å¸¸
- æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
- æ£€æŸ¥è¡¨æ˜¯å¦æœ‰æ³¨é‡Šï¼ˆå»ºè®®æ·»åŠ è¡¨å’Œå­—æ®µæ³¨é‡Šï¼‰
- æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 5. Python ä»£ç æ‰§è¡Œå¤±è´¥

**é”™è¯¯ä¿¡æ¯**:
```
Python execution failed
```

**è§£å†³æ–¹æ¡ˆ**:
- å¼€å‘ç¯å¢ƒï¼šç¡®ä¿æœ¬åœ°å®‰è£…äº† Python 3.8+
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ Docker æ¨¡å¼
- æ£€æŸ¥ Python ä¾èµ–æ˜¯å¦å®‰è£…ï¼ˆpandas, matplotlib ç­‰ï¼‰

---

## ğŸ“š ä¸‹ä¸€æ­¥

### å­¦ä¹ èµ„æº

- [è®¾è®¡æ–¹æ¡ˆæ–‡æ¡£](./è®¾è®¡æ–¹æ¡ˆæ–‡æ¡£.md) - äº†è§£ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡
- [æ¶æ„å›¾](./æ¶æ„å›¾.md) - æŸ¥çœ‹å„ç±»æ¶æ„å›¾å’Œæµç¨‹å›¾
- [API æ–‡æ¡£](./APIæ–‡æ¡£.md) - æŸ¥çœ‹å®Œæ•´çš„ API æ¥å£è¯´æ˜

### è¿›é˜¶é…ç½®

1. **é…ç½®ä¸šåŠ¡çŸ¥è¯†åº“**
   - æ·»åŠ ä¸šåŠ¡æœ¯è¯­å’ŒåŒä¹‰è¯
   - æå‡ NL2SQL ç†è§£å‡†ç¡®æ€§

2. **é…ç½®è¯­ä¹‰æ¨¡å‹**
   - ä¸ºå­—æ®µæ·»åŠ åŒä¹‰è¯
   - ä¼˜åŒ–å­—æ®µå¬å›æ•ˆæœ

3. **é…ç½®é¢„è®¾é—®é¢˜**
   - æ·»åŠ å¸¸ç”¨æŸ¥è¯¢æ¨¡æ¿
   - æå‡ç”¨æˆ·ä½“éªŒ

4. **å¯ç”¨äººå·¥å®¡æ ¸**
   - åœ¨æ™ºèƒ½ä½“è®¾ç½®ä¸­å¯ç”¨
   - å…³é”® SQL æ‰§è¡Œå‰äººå·¥ç¡®è®¤

5. **åˆ‡æ¢å‘é‡æ•°æ®åº“**
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Milvus
   - æå‡æ£€ç´¢æ€§èƒ½å’Œç¨³å®šæ€§

---

## ğŸ” å®‰å…¨å»ºè®®

### å¼€å‘ç¯å¢ƒ

- âœ… ä½¿ç”¨æµ‹è¯•æ•°æ®åº“
- âœ… ä¸è¦ä½¿ç”¨ç”Ÿäº§æ•°æ®
- âœ… API Key ä¸è¦æäº¤åˆ°ä»£ç ä»“åº“

### ç”Ÿäº§ç¯å¢ƒ

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… æ•°æ®æºå¯†ç åŠ å¯†å­˜å‚¨
- âœ… Python ä»£ç ä½¿ç”¨ Docker éš”ç¦»æ‰§è¡Œ
- âœ… å¯ç”¨ API è®¿é—®æ§åˆ¶å’Œé™æµ
- âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“
- âœ… ç›‘æ§ API è°ƒç”¨é‡å’Œè´¹ç”¨

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ•°æ®æºé…ç½®

- ä¸ºè¡¨å’Œå­—æ®µæ·»åŠ è¯¦ç»†çš„æ³¨é‡Š
- ä½¿ç”¨æœ‰æ„ä¹‰çš„è¡¨åå’Œå­—æ®µå
- å»ºç«‹åˆç†çš„å¤–é”®å…³ç³»

### 2. ä¸šåŠ¡çŸ¥è¯†é…ç½®

- æ·»åŠ è¡Œä¸šæœ¯è¯­å’Œç¼©å†™
- é…ç½®å¸¸ç”¨çš„åŒä¹‰è¯
- å®šæœŸæ›´æ–°çŸ¥è¯†åº“

### 3. Prompt ä¼˜åŒ–

- æ ¹æ®ä¸šåŠ¡åœºæ™¯è‡ªå®šä¹‰ Prompt
- æä¾›æ¸…æ™°çš„ç¤ºä¾‹
- æ˜ç¡®è¾“å‡ºæ ¼å¼è¦æ±‚

### 4. æ€§èƒ½ä¼˜åŒ–

- åˆç†è®¾ç½®å‘é‡æ£€ç´¢çš„ TopK
- ç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥

---

## ğŸ†˜ è·å–å¸®åŠ©

### ç¤¾åŒºæ”¯æŒ

- GitHub Issues: [æäº¤é—®é¢˜](https://github.com/alibaba/spring-ai-alibaba/issues)
- é’‰é’‰ç¾¤: åŠ å…¥ Spring AI Alibaba ç¤¾åŒºç¾¤
- æ–‡æ¡£: [Spring AI Alibaba å®˜æ–¹æ–‡æ¡£](https://github.com/alibaba/spring-ai-alibaba)

### è´¡çŒ®ä»£ç 

æ¬¢è¿æäº¤ PR å’Œ Issueï¼è¯·å‚è€ƒ [è´¡çŒ®æŒ‡å—](https://github.com/alibaba/spring-ai-alibaba/blob/main/CONTRIBUTING-zh.md)ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-11-06  
**ç»´æŠ¤å›¢é˜Ÿ**: DataAgent å¼€å‘å›¢é˜Ÿ

